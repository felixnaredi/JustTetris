#!/usr/bin/env ruby
#
# Filename: makemake
# Created: 2018-02-18 04:34:29 +0100
# Author: Felix Nared
#

def target_dir
	Dir.new("#{Dir.pwd}/#{ARGV[0]}")
end

f = open "#{target_dir.path}/Makefile",'w'

f.puts "\#\n\# Generated by makemake\n\# #{Time.new}\n\#\n\n"

target_dir.each { |e|
  next unless /.+\.cc?$/.match e

  r = (/(.+)\.cc?/.match e)[1]
  ls = (open "#{target_dir.path}/#{e}").read.lines

  while !ls.empty?
    next unless /\/\/\sBUILD:/.match ls.shift

    f.puts "#{r}:\n\t#{/\/\/\s+(.*)/.match(ls.shift)[1]}"
    break
  end
}

f.puts "clean:\n\trm -f *~ *.o *_log log_*"
